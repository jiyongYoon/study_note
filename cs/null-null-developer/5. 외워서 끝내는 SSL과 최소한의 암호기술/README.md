# 1. 기초 이론

## 1) Checksum(검사합)

- 원본과 복사본(다운로드 등)의 데이터 오류 여부 확인방법
- 자릿수를 유지하여 일정 계산을 통해 원본과 복사본이 값이 동일한지 확인하는 방법
- 단, 보안성이 없다. => `Hash`가 추가되어야 함
- 최종결과로 원본을 복원하는 것은 불가능하다.


## 2) Hash 함수

- 단방향성!
- 데이터 무결성 확보에 사용됨 (위변조 X)
- 사용처
  - 무결성 확보
    - 인증서 검증
    - 디지털 포렌식
    - 디지털 서명(Hash + PKI)
  - 패스워드 단방향 암호화
  - 블록체인
- 대표적인 알고리즘
  - `MD-5` 
    - 패스워드 암호화에는 사용금지
    - 길이가 너무 짧아서 Brute Force 공격에 뚫릴 가능성이 있음
  - `SHA-1`
  - `SHA-128, 256, 384, 512`
    - 숫자 길이가 클수록 경우의 수가 늘어나 보안성이 더 높아짐

> **해킹 가능성?**
> 
> MD-5로 해시했다는 정보를 알게 된다면, 해시값으로 원본값은 알 수 없지만, 많은 모수를 돌려서 동일한 해시값이 나오게 할 수 있음

> **SALT 값?**
> 
> 단방향 Hashing을 할 때, 데이터를 추가하여 Hashing을 하는 방법 => Hashing 할 때 변수가 2개이기 때문에 원본 추적이 훨씬 어려워짐

> **블록체인?**
> 
> 공개 데이터의 무결성을 확보하는 기술.
> 데이터를 체이닝하여 생성하는데, 위변조 보호를 위해 Hash가 사용된다.
> 체이닝 데이터 생성 시 바로 앞 데이터의 Hash값을 추가하여 Hashing을 진행하여 체이닝을 했을 때 데이터 위변조 난이도가 높아지며, 결국 불가능하게 되는 상황이 구현된다.
> 추가적인 핵심 개념으로 분산저장과 합의 매커니즘 등이 있다.

---

# 2. 암호기술에 대한 이해

## 1) 대칭키

- **키가 1개. 암호화 복호화에 모두 사용.**
- 비대칭키에 비해서 **효율적**
- DES, 3DES, SEED-128, ARIA, **AES-128**, **AES-256** 알고리즘 등이 있음
  - 논리연산 `XOR`을 사용하게 됨

## 2) 비대칭키

- 키가 2개, 1쌍. **하나는 암호화 / 하나는 복호화에 사용**
- 두 키 중에 공개하는 키를 공개키(Public key), 노출하지 않는 키를 개인키(Private key)라고 함
- 이러한 형태를 **PKI**(Public Key Infrastructure)라고 부름
- **RSA-2048**, ECC 알고리즘 등이 있음
  - `mod` 연산을 하게 되며, 이 중 `public key`와 `modulus`값이 공개키에 공개되어 있는 형태
    ```
    `평문` ^ {public key} mod {modulus} = `암호문`
    `암호문` ^ {private key} mod {modulus} = `평문`
    ```

## 3) 디지털 서명

<img src="https://github.com/user-attachments/assets/74503c59-ab27-4df4-81fd-29c64c9ad319" alt="adder" width="50%" />

- 정보의 무결성을 보장하는 과정
- 암호화 과정
  - `정보` -> `Hash` -> `내 Private key로 암호화`
- 복호화 과정
  - `암호화된 정보` -> `공개된 Public key로 복호화` -> `Hash`-> 나온 해시값 비교 

---

# 3. PKI 시스템과 인터넷

대칭키는 효율적인데, 복호화가 가능한 `키`를 public internet으로 보내는 것은 위험하다. => 대칭키 생성을 위한 `비대칭키` 등장

## 1) 비대칭키와 Tunnel

- 통신하고자 하는 Client와 Server는 각 한 쌍의 비대칭키를 생성한다.
- 서로 교환을 할 때 `Public key`를 교환한다.
- 이후 데이터 암호화는 `상대방의 Public key`, 복호화는 `나의 Private key`로 하여 통신한다.
- 이러한 데이터 전송이 이루어지는 채널을 `Tunnel`이라고 한다.

> 비대칭키는 생성 및 암-복호화에 시간이 많이 걸린다. 
> 그리고 Public key는 결국 인터넷에 오픈되다보니 Privatre key 유추의 위험성이 있다. 
> 
> 매 요청을 이렇게 사용할수는 없다.

## 2) 대칭키와 비대칭키 혼합 사용

앞서 배운것처럼 암-복호화에는 대칭키가 효율이 좋다. 따라서 비대칭키를 사용해서 대칭키를 이동시키는 혼합 사용을 하게 된다.

- Server는 한 쌍의 비대칭키를 생성한다.
- Client는 대칭키를 생성한다.
- Client는 `상대방의 Public key를 가지고 내 대칭키를 암호화하여 보낸다`
- Server는 내 `Private key`로 복호화하여 `상대방의 대칭키`를 획득한다.
- 서로간의 통신은 해당 대칭키로 암-복호화 한다.

> 각 연결마다 대칭키가 존재하기 때문에 `Session key`라고 하기도 하며,
> 인터넷에 공개된 Server의 Public key와 쌍을 이루는 Private key와 데이터 자체와의 연관성이 없다보니
> 보안에 더 유리하다.
> 
> 그런데, 받은 Server의 Public key가, `내가 접속하고자 했던 Server가 보낸게 맞는거야?` (MITM, 중간자 공격)

## 3) 공개키 신뢰 검증

- 등장요소
  - RA: 인증서 등록대행
  - CA: 인증서 보증기관
  - Server: 인증서 필요업체

- Server측에서 RA에게 `비대칭키 한 쌍` 구매 요청을 한다.
- RA는 CA에게 확인 및 비대칭키 한 쌍을 전달받는다.
  - CA는 Public key를 `X.509` 형식으로 발급하며, 이 안에는 관련 부가 정보들과 `해당 내용을 가지고 암호화된 Hash 값`을 포함한다.
    - CA는 이 Hash 값을 암호화 할 때 `자신의 비대칭 키 쌍 중에서 Private key`로 암호화를 한다.
  - 인증 정보종류에 따라 인증서에 담기는 정보 및 가격이 달라진다. (암호화의 정도와는 무관하다.)
  - 이 Public key를 `(SSL) 인증서`라고 한다.
  - 유호기간은 보통 1년이다.
- Server는 해당 인증서를 자신의 서버에 등록한다.
- 클라이언트 PC에는 `기관 인증서`가 설치되어 있는데, 이게 바로 CA가 가진 `Public key` 내용이다.

  <img src="https://github.com/user-attachments/assets/8af80423-2667-4b21-86d6-f2427bdec40b" alt="adder" width="70%" />  

  - 서버가 보내준 인증서의 Hash 값은 `CA의 Private key로 암호화`된 값이므로, `CA의 Public key인 기관인증서로 복호화`가 가능하다.
  - 즉, 비대칭키 전달 생태계가 더 크게 확장되었다고 보면 되겠다.
- `Public key` 검증 후 자신의 대칭키(Session key)를 암호화해서 서버에 보내면 된다.

> 클라이언트는 기관인증서로 서버에서 전달받은 인증서를 복호화 한 후 `Hash 값`이 동일하면 해당 인증서를 신뢰할 수 있다. (디지털 서명)

## 4) PKI 인증 체계

<img src="https://github.com/user-attachments/assets/c3944ed3-ce48-4109-a250-7006bd0a9247" alt="adder" width="70%" />

정리하면
- 서버에서는 디지털 서명이 되어있는 (SSL) 인증서를 클라이언트에게 보내주게 된다.
- 디지털 서명(Hasing)은 CA의 Private key로 암호화되어 있다.
- 클라이언트는 공개된 CA의 Public key로 디지털 서명을 확인하여 데이터 무결성을 체크하여 인증서를 신뢰한다.

여기까지가 `디지털 서명과 인증`에 대한 내용이다. 즉, 인증서 내부에 있는 데이터를 `신뢰`하는 작업인 것이다.
`암호화 통신`이 필요한 경우 아래 작업을 추가로 하게 되는 것이다.
- 클라이언트의 대칭키(Session key)는 (SSL) 인증서 안에 있는 Public key로 암호화하여 서버에 보낸다.
- 서버는 CA로부터 받은 비대칭키 쌍 중 Private key로 복호화하여 클라이언트의 대칭키(Session key)를 획득한다.

예전에는 공공기관에서만 CA를 담당했는데, 규제가 풀려서 이제는 각종 은행기관, 민간업체들도 CA가 가능해졌다. <br>
**=> 각 금융기관별 `금융인증서`, IT 업체들의 `민간인증서` 등이 그런 CA 기관을 담당하게 된 것이다.**
