![img.png](img.png)

## I/O 간단 정리

### 1. Java는 JVM 레벨에서 버퍼를 한번 더 이용할 수 있다. 
이 버퍼는 디스크 flush 전에 사용되는 OS 레벨의 버퍼(페이지 캐시;Page Cache)와는 다르며 JVM Process에 할당된 Heap Memory이다.
이 버퍼의 목적은 OS 레벨의 버퍼에 데이터를 쓰는 `시스템 콜(open(), read(), write(), close()...)`를 줄이기 위함이다.

### 2. OS 레벨의 버퍼는 페이지 캐시 공간에 마련되며, OS가 관리한다.
디스크 I/O는 속도가 매우 느리다. 따라서 OS 레벨의 버퍼가 있는데, 이는 I/O할 데이터를 모아서 한 번에 flush하는 용도이다. 

> OS가 이 부분을 생각보다 훨씬 잘 관리한다. **적극적으로 활용하면 어떨까?** <br>
> --> Kafka Broker의 철학; producer 데이터를 Page Cache에 적재하고, consumer가 데이터를 Page Cache에서 직접 읽는다. 즉, `Cache Hit`율을 극대화하여 성능 향상 

### 3. 사실 모든것은 파일이다. `VFS(virtual file system)`는 컴퓨터 하드웨어에 시스템 콜을 보낼 수 있게 해주는 추상화 계층이다.
OS 레벨에서 프로세스가 하드웨어 자원을 활용하도록 하기 위해서 추상화를 제공한다. 이 추상화를 통해 프로세스는 OS에게 h/w 사용 요청 등을 할 수 있게 된다.
VFS는 보통 OS에서 제공을 하며, VFS의 실제 구현체인 파일시스템(e.g. NTFS, ext4...), 네트워크 스택, 장치 드라이버 등을 추가로 설치(및 OS 기본제공)해서 사용하게 된다.
```text
VFS = "Everything is a File" 철학의 구현체

┌─────────────────────────────────────┐
│   애플리케이션                        │ 
│   "나는 그냥 open(), read(), write() │
│    하면 돼. 뒤에 뭐가 있는지 몰라"     │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│   VFS (통합 추상화 계층)              │
│   "모든 걸 파일처럼 보이게 만들자"     │
└─────────────────────────────────────┘
         ↙        ↓        ↘
┌─────────┐  ┌────────┐  ┌─────────┐
│ 파일     │ │네트워크 │  │ 하드웨어 │
│ 시스템   │ │ (NIC)  │    장치들   │
└─────────┘  └────────┘  └─────────┘
```